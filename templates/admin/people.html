{extends file='admin.tpl'}

{block name=main}
<div class="page-header">
	<h1>與會者管理後台</h1>
</div>

<ol class="breadcrumb">
	<li><a href="{$smarty.const.TOP}/admin/index.php?token={$token}">管理後台</a></li>
	<li class="active">與會者</li>
</ol>

<div class="table-responsive">
<table class="table table-hover table-bordered">
	<thead>
		<tr>
			<th>姓名</th>
			<th>相片</th>
			<th>Email</th>
			<th>Passcode</th>
			<th>Committee</th>
			<th>Sessions <span class="label label-primary"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Organizer</span></th>
			<th></th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		{foreach $people as $person}
		<tr>
			<td>{$person['first_name']|escape} {$person['last_name']|escape}</td>
			<td>
				{if $person.img}
				<img class="img-responsive" src="{$smarty.const.TOP}/uploads/{$person.img}" style="max-height: 50px;">
				{/if}
			</td>
			<td>{$person['email']|escape}</td>
			<td>
				{foreach $person.tokens as $auth}
				<a href="{$smarty.const.TOP}/person/main.php?token={$auth.token}">{$auth.token}</a><br>
				{/foreach}
			</td>
			<td>{foreach $person.committees as $committee}
				<span class="label label-default">{$committee.type}</span>
			{/foreach}</td>
			<td>{foreach $person['talks'] as $talk}
				{if $talk.session eq 'Plenary'}
					<a href="{$smarty.const.TOP}/plenary_session.php?talk_id={$talk.id}">
						<span class="label label-{if $talk.title eq ''}default{else}success{/if}">Plenary</span>
					</a>
				{elseif $talk.session eq 'Parallel'}
					<a href="{$smarty.const.TOP}/admin/parallel_session.php?mode=edit&session_id={$talk.session_id}&token={$token}">
						<span class="label label-{if $talk.title eq ''}default{else}success{/if}">Parallel ({$sessions[$talk.session_id].abbreviation})</span>
					</a>
				{elseif $talk.session eq 'Poster'}
					<span class="label label-default">{$talk.session}</span>
				{/if}
			{/foreach}
			{foreach $person.organizers as $organizer}
				<a href="{$smarty.const.TOP}/admin/parallel_session.php?mode=edit&session_id={$organizer.session_id}&token={$token}">
					<span class="label label-primary"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> {$sessions[$organizer.session_id].abbreviation}</span>
				</a>
			{/foreach}</td>
			<td><a class="btn btn-default" href="{$smarty.const.TOP}/admin/person.php?token={$token}&id={$person['id']}&mode=edit">編輯</a></td>
			<td>
				<form method="POST" action="{$smarty.const.TOP}/admin/person/delete.php?token={$token}">
					<input type="hidden" name="id" value="{$person['id']}" />
					<button class="btn btn-danger" onClick="return confirm('確定刪除？');">刪除</button>
				</form>
			</td>
		</tr>
		{/foreach}
	</tbody>
</table>
</div>

<h2>新增</h2>
<form class="form-inline" action="{$smarty.const.TOP}/admin/person/insert.php?token={$token}" method="POST">
<div class="table-responsive">
<table class="table table-hover">
	<thead>
		<tr>
			<th>參加類型</th>
			<th>姓名</th>
			<th>Email</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				<select class="form-control" name="type" required>
					<option value=""></option>
					<option value="Normal">Attendee</option>
					<option value="Plenary">Plenary Session Speaker</option>
					<option value="Parallel">Parallel Session Speaker</option>
					<option value="Poster">Poster</option>
				</select>
			</td>
			<td>
				<input type="text" class="form-control" name="first_name" placeholder="First Name" required>
				<input type="text" class="form-control" name="last_name" placeholder="Last Name" required>
			</td>
			<td><input type="email" class="form-control" name="email" placeholder="Speaker Email"></td>
			<td><button type="submit" class="btn btn-primary" disabled>新增</button></td>
		</tr>
	</tbody>
</table>
</div>
</form>
{/block}
